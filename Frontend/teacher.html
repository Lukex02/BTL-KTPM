<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instructor Dashboard - Academic Hub</title>
    <style type="text/css">@font-face {font-family:Poppins;font-style:normal;font-weight:300;src:url(/cf-fonts/s/poppins/5.0.11/latin/300/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:300;src:url(/cf-fonts/s/poppins/5.0.11/devanagari/300/normal.woff2);unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:300;src:url(/cf-fonts/s/poppins/5.0.11/latin-ext/300/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:400;src:url(/cf-fonts/s/poppins/5.0.11/latin-ext/400/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:400;src:url(/cf-fonts/s/poppins/5.0.11/devanagari/400/normal.woff2);unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:400;src:url(/cf-fonts/s/poppins/5.0.11/latin/400/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:500;src:url(/cf-fonts/s/poppins/5.0.11/devanagari/500/normal.woff2);unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:500;src:url(/cf-fonts/s/poppins/5.0.11/latin/500/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:500;src:url(/cf-fonts/s/poppins/5.0.11/latin-ext/500/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:600;src:url(/cf-fonts/s/poppins/5.0.11/latin-ext/600/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:600;src:url(/cf-fonts/s/poppins/5.0.11/latin/600/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:600;src:url(/cf-fonts/s/poppins/5.0.11/devanagari/600/normal.woff2);unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:700;src:url(/cf-fonts/s/poppins/5.0.11/devanagari/700/normal.woff2);unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FF;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:700;src:url(/cf-fonts/s/poppins/5.0.11/latin/700/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Poppins;font-style:normal;font-weight:700;src:url(/cf-fonts/s/poppins/5.0.11/latin-ext/700/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}</style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/teacher.css">
</head>
<body>
    <div class="add-modal-overlay" id="add-student-modal">
        <div class="add-modal-content" style="max-width: 800px; width: 90%;">
            <div class="modal-header">
                <h3>Add New Student</h3>
                <button class="close-modal" onclick="hideAddStudentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="search-box" style="margin-bottom: 20px;">
                    <i class="fas fa-search"></i>
                    <input type="text" id="student-search" placeholder="Search students..." oninput="filterStudents()">
                </div>
                
                <div id="add-students-loading" style="text-align:center; padding:40px; display:none;">
                    <i class="fas fa-spinner fa-spin" style="font-size:24px; color:#1A64F0;"></i>
                    <span style="margin-left:10px;">Đang tải...</span>
                </div>

                <div id="add-students-empty" style="text-align:center; padding:60px; color:#888; display:none;">
                    <i class="fas fa-users" style="font-size:48px; margin-bottom:16px; opacity:0.3;"></i>
                    <p>Không còn học sinh nào để thêm</p>
                </div>

                <div id="available-students-list" class="students-grid" style="width: 80%;"></div>
            </div>
            <div class="modal-footer" style="text-align: right; padding: 16px; border-top: 1px solid #eee;">
                <button type="button" class="btn-outline" onclick="hideAddStudentModal()">Close</button>
            </div>
        </div>
    </div>
    <!-- Modal Change Password -->
<div class="modal-overlay" id="change-password-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Change Password</h3>
            <button class="close-modal" onclick="hideChangePasswordModal()">&times;</button>
        </div>
        <form id="change-password-form">
            <div class="form-group">
                <label>Current Password</label>
                <input type="password" id="old-password" class="form-control" >
            </div>
            <div class="form-group">
                <label>New Password</label>
                <input type="password" id="new-password" class="form-control"  minlength="6">
            </div>
            <div class="form-group">
                <label>Confirm New Password</label>
                <input type="password" id="confirm-password" class="form-control"  minlength="6">
            </div>
            <div id="password-message" style="margin: 10px 0; font-size: 14px;"></div>
            <div style="text-align: right; margin-top: 20px;">
                <button type="button" class="btn-outline" onclick="hideChangePasswordModal()">Cancel</button>
                <button type="submit" class="btn-primary" style="margin-left: 10px;">Update Password</button>
            </div>
        </form>
    </div>
</div>
    <div class="sidebar">
        <div class="logo"><img src="./assets/BK 1.png" class="logo-icon" alt="Logo"> ITS System</div>
        
        <a href="#" class="tab-btn active" onclick="switchTab(this, 'inst-dashboard')"><i class="fas fa-chart-pie"></i> Dashboard</a>
        <a href="#" class="tab-btn" onclick="switchTab(this, 'create-quiz')"><i class="fas fa-plus-circle"></i> Quiz Manager</a>
        <a href="#" class="tab-btn" onclick="switchTab(this, 'my-students')"><i class="fas fa-user-graduate"></i> My Students</a>
        <a href="#" class="tab-btn" onclick="switchTab(this, 'resources'); loadContents()"><i class="fas fa-folder-open"></i> Resources</a>
        <!-- <a href="#" class="tab-btn" onclick="switchTab(this, 'inst-message')"><i class="fas fa-comment-dots"></i> Message <span class="badge-mini">3</span></a> -->
        <a href="#" class="tab-btn" onclick="switchTab(this, 'inst-settings')"><i class="fas fa-cog"></i> Settings</a>
        
        <a href="login.html" class="logout-link"><i class="fas fa-sign-out-alt"></i> Sign out</a>
    </div>

    <div class="content">
        
        <div class="top-header">
            <div class="greeting">
                <h2>Good Morning, Khánh!</h2>
                <p>Senior Instructor Dashboard</p>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search...">
                </div>
                <div class="user-action">
                    <button><i class="far fa-bell"></i></button>
                    <div class="avatar-wrapper" id="avatar-wrapper" style="cursor: pointer;">
                        <!-- <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100" alt="User" class="avatar-img"> -->
                         <img src="./assets/Edit Avatar.png" alt="User" class="avatar-img">
                        <div class="user-dropdown" id="user-dropdown" style="margin-top: 2%;">
                            <a href="#" onclick="showChangePasswordModal(); return false;">Change Password</a>
                        </div>
                    </div>
                </div>
</div>
        </div>

        <div class="tab-content-wrapper">

            <div id="inst-dashboard-content" class="tab-pane active">
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon icon-orange"><i class="fas fa-file-alt"></i></div>
                        <div class="stat-info"><h3>957</h3><p>Total Quiz</p></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon icon-purple"><i class="fas fa-user-check"></i></div>
                        <div class="stat-info"><h3>19</h3><p>Active Students</p></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon icon-yellow"><i class="fas fa-users"></i></div>
                        <div class="stat-info"><h3>241</h3><p>Total Students</p></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon icon-green"><i class="fas fa-dollar-sign"></i></div>
                        <div class="stat-info"><h3>$7,443</h3><p>Total Revenue</p></div>
                    </div>
                </div>

                <div class="middle-section">
                    <div class="card-box">
                        <div class="card-header"><h3>Recent Activity</h3><i class="fas fa-ellipsis-h"></i></div>
                        <ul class="activity-list">
                            <li class="activity-item">
                                <div class="act-icon"><i class="fas fa-book"></i></div>
                                <div class="act-text"><p>Kevin bought "UI/UX"</p><span>Just now</span></div>
                            </li>
                            <li class="activity-item">
                                <div class="act-icon"><i class="fas fa-star"></i></div>
                                <div class="act-text"><p>John rated 5 stars</p><span>5 mins ago</span></div>
                            </li>
                            <li class="activity-item">
                                <div class="act-icon"><i class="fas fa-shopping-cart"></i></div>
                                <div class="act-text"><p>New sale recorded</p><span>1 hour ago</span></div>
                            </li>
                        </ul>
                    </div>
                    <div class="card-box">
                        <div class="card-header"><h3>Revenue</h3><select><option>This Month</option></select></div>
                        <div class="chart-placeholder">
                            <div style="display:flex; align-items:flex-end; gap:10px; height:100%; width:100%; padding:0 20px;">
                                <div style="width:20%; height:40%; background:#EBEBFF; border-radius:4px;"></div>
                                <div style="width:20%; height:70%; background:#1A64F0; border-radius:4px;"></div>
                                <div style="width:20%; height:50%; background:#EBEBFF; border-radius:4px;"></div>
                                <div style="width:20%; height:85%; background:#1A64F0; border-radius:4px;"></div>
                                <div style="width:20%; height:60%; background:#EBEBFF; border-radius:4px;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="my-students">
                    <h1>My Students</h1>
                    <button class="btn-primary" onclick="showAddStudentModal()" style="margin-top:10px;"><i class="fas fa-plus"></i> Add Student</button>
                <p class="list-title">List of students you are in charge of</p>

                <div id="students-loading" style="text-align:center; padding:40px; display:none;">
                    <i class="fas fa-spinner fa-spin" style="font-size:24px; color:#1A64F0;"></i>
                    <span style="margin-left:10px;">Đang tải...</span>
                </div>

                <div id="students-empty" style="text-align:center; padding:60px; color:#888; display:none;">
                    <i class="fas fa-users" style="font-size:48px; margin-bottom:16px; opacity:0.3;"></i>
                    <p>Chưa có học sinh nào được giao cho bạn</p>
                </div>

                <div id="dashboard-students-list" class="student-grid"></div>
                </div>
                <button class="btn-see-more" onclick="goToMyStudentsTab()">See More</button>
            </div>

            <div id="create-quiz-content" class="tab-pane">
                
                <div id="quiz-list-view">
                    <div class="section-header">
                        <h2>Quiz Management</h2>
                        <button class="btn-primary" onclick="showCreateQuizForm()"><i class="fas fa-plus"></i> Create New Quiz</button>
                    </div>
                    
                    <div class="quiz-manager-grid" id="quiz-manager-grid">
                        <!-- Các quiz sẽ được render động ở đây -->
                    </div>
                </div>

                <div id="quiz-form-view" style="display: none;">
                    <h1 id="quiz-form-title">Create New Quiz</h1>
                    <div class="section-header">
                        <button class="btn-back-text" onclick="hideCreateQuizForm()"><i class="fas fa-arrow-left"></i> Back to List</button>
                        <div class="form-actions">
                            <button class="btn-outline">Save Draft</button>
                            <button class="btn-primary">Save & Preview</button>
                        </div>
                    </div>
                    <form id="create-quiz-form">
                        <input type="hidden" id="quiz-id" value="">
                        <div id="quiz-message" style="display: none;"></div>
                        <div class="quiz-steps">
                        <button type="button" class="step-btn active" onclick="switchQuizStep('basic')">1. Basic Information</button>
                        <button type="button" class="step-btn" onclick="switchQuizStep('question')">2. Question Settings</button>
                        <button type="button" class="step-btn" onclick="switchQuizStep('publish')">3. Publish</button>
                        </div>
                    <div class="step-progress-bar"><div class="bar-fill" id="quiz-progress-fill" style="width: 33%;"></div></div>

                    <div id="step-basic" class="step-content active">
                        <div class="card-box">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="quiz-title" class="form-control" placeholder="Your course title">
                                <span class="char-count">0/80</span>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea class="form-control" id="quiz-description" placeholder="Course subtitle"></textarea>
                                <span class="char-count">0/120</span>
                            </div>
                            <!-- <div class="row-2-col">
                                <div class="form-group">
                                    <label>Category</label>
                                    <select class="form-control"><option>Select...</option><option>Coding</option><option>Design</option></select>
                                </div>
                                <div class="form-group">
                                    <label>Level</label>
                                    <select class="form-control"><option>Beginner</option><option>Intermediate</option><option>Advanced</option></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Quiz Timer (Minutes)</label>
                                <input type="number" class="form-control" placeholder="Example: 45">
                            </div> -->
                            
                            <!-- <div class="upload-area">
                                <i class="fas fa-image"></i>
                                <p>Upload Quiz Thumbnail (1200x800 pixels)</p>
                                <button class="btn-outline">Choose Image</button>
                            </div> -->
                        </div>
                        <div class="step-footer">
                            <button type="button" class="btn-primary" onclick="switchQuizStep('question')">Next Step <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>

                    <div id="step-question" class="step-content">
                        <div id="questions-container">
                        <!-- Dynamic questions sẽ add ở đây -->
                        <div class="question-group">
                            <h3>Question 1</h3>
                            <input type="text" class="question-text" placeholder="Question" required>
                            <select class="question-type" onchange="toggleOptions(this)">
                                <option value="">Select Type</option>
                                <option value="text">Text</option>
                                <option value="number">Number</option>
                                <option value="multiple-choice">Multiple Choice</option>
                            </select>
                            <div class="options-container" style="display: none;">
                                <h4>Options</h4>
                                <div class="option-group">
                                    <input type="text" class="option-text" placeholder="Option 1">
                                </div>
                                <button type="button" class="add-option" onclick="addOption(this)">Add Option</button>
                            </div>
                            <textarea class="question-explanation" placeholder="Question Explanation (optional)"></textarea>
                            <textarea class="answer-explanation" placeholder="Answer Explanation (optional)"></textarea>
                            <input type="text" class="correct-answer" placeholder="Correct Answer (optional)">
                        </div>
                    </div>
                    <button type="button" onclick="addQuestion()" class="btn-outline">Add Question</button>
                        <div class="step-footer">
                            <button type="button" class="btn-outline" onclick="switchQuizStep('basic')">Previous</button>
                            <button type="button" class="btn-primary" onclick="switchQuizStep('publish')">Next Step <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>

                    <div id="step-publish" class="step-content">
                        <div class="card-box">
                            <h3>Publish Settings</h3>
                            <!-- <div class="form-group">
                                <label for="quiz-visibility">Visibility</label>
                                <select id="quiz-visibility" class="form-control">
                                    <option value="public">Public</option>
                                    <option value="private">Private</option>
                                </select>
                            </div> -->
                            <div class="form-group" id="current-assigned" style="display:none;">
                                <label>Current Assigned Students</label>
                                <p id="current-assigned-names"></p>
                            </div>
                            <div class="form-group">
                                <label for="assign-student">Assign to Student (Optional - Select one)</label>
                                <select id="assign-student" class="form-control">
                                    <option value="">-- Select a student --</option>
                                    <!-- Options sẽ được fill động bởi JS -->
                                </select>
                            </div>
                            <!-- <p class="form-info">Additional publish options...</p> -->
                        </div>
                                                <div class="step-footer">
                            <button class="btn-outline" onclick="switchQuizStep('question')">Previous</button>
                            <button type="submit" class="btn-primary" id="publish-button">Publish Quiz</button>
                        </div>
                    </div>

                    </div>
                    </form>
                    

                </div> 
            
            
            </div>

            <!-- Cập nhật phần HTML cho tab My Students (teacher.html) -->
        <div id="my-students-content" class="tab-pane">
            <div class="section-header">
                <h1>My Students</h1>
                <button class="btn-primary" onclick="showAddStudentModal()"><i class="fas fa-plus"></i> Add Student</button>
            </div>
            <p class="list-title">List of students you are in charge of</p>


            <div id="students-loading" style="text-align:center; padding:40px; display:none;">
                <i class="fas fa-spinner fa-spin" style="font-size:24px; color:#1A64F0;"></i>
                <span style="margin-left:10px;">Đang tải...</span>
            </div>

            <div id="students-empty" style="text-align:center; padding:60px; color:#888; display:none;">
                <i class="fas fa-users" style="font-size:48px; margin-bottom:16px; opacity:0.3;"></i>
                <p>Chưa có học sinh nào được giao cho bạn</p>
            </div>

            <div id="students-list" class="students-grid"></div>
        </div>

            <div id="resources-content" class="tab-pane">
                <div class="section-header"><h3>Course Resources</h3><button class="btn-primary"><i class="fas fa-upload"></i> Upload File</button></div>
                <div class="resource-grid">
                    <div class="res-card">
                        <div class="res-icon pdf"><i class="fas fa-file-pdf"></i></div>
                        <div class="res-info"><h4>Python Syllabus.pdf</h4><p>2.4 MB • 2 days ago</p></div>
                        <button class="btn-icon-small"><i class="fas fa-download"></i></button>
                    </div>
                    <div class="res-card">
                        <div class="res-icon fig"><i class="fab fa-figma"></i></div>
                        <div class="res-info"><h4>UI Design Assets.fig</h4><p>15 MB • 1 week ago</p></div>
                        <button class="btn-icon-small"><i class="fas fa-download"></i></button>
                    </div>
                    <div class="res-card">
                        <div class="res-icon doc"><i class="fas fa-file-word"></i></div>
                        <div class="res-info"><h4>Final Assignment.docx</h4><p>500 KB • 3 days ago</p></div>
                        <button class="btn-icon-small"><i class="fas fa-download"></i></button>
                    </div>
                </div>
            </div>

            <div id="inst-message-content" class="tab-pane">
                <div class="message-layout" style="height: 600px;">
                    <div class="msg-sidebar" style="width: 300px;">
                        <div class="msg-header"><h3>Chats</h3></div>
                        <div class="contact-list">
                            <div class="contact-item active">
                                <div class="contact-avatar"><img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=64"></div>
                                <div class="contact-info"><div class="c-name">Wade Warren</div><p class="c-preview">Can you check my code?</p></div>
                            </div>
                            <div class="contact-item">
                                <div class="contact-avatar"><img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=64"></div>
                                <div class="contact-info"><div class="c-name">Bessie</div><p class="c-preview">Thanks for the lecture!</p></div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-window">
                        <div class="chat-header"><h4>Wade Warren</h4></div>
                        <div class="chat-body" style="background:#F5F7FA;">
                            <div class="msg-row received"><div class="msg-bubble" style="background:#fff;">Hello Professor!</div></div>
                            <div class="msg-row sent"><div class="msg-bubble" style="background:#1A64F0; color:#fff;">Hi Wade, how can I help?</div></div>
                        </div>
                        <div class="chat-footer">
                            <input type="text" class="form-control" placeholder="Type a message...">
                            <button class="btn-primary" style="margin-left:10px;">Send</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add this inside the <div class="tab-content-wrapper">, after the existing tab-panes -->
            <div id="inst-settings-content" class="tab-pane">
                <h1 style="margin-bottom: 10px;">Settings</h1>
                <h3>Update Profile</h3>
                <form id="update-profile-form" style="margin-top: 10px;">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="profile-username" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="profile-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="profile-email" class="form-control" required>
                    </div>
                    <div id="profile-message" style="margin: 10px 0; font-size: 14px;"></div>
                    <div style="text-align: right; margin-top: 20px;">
                        <button type="submit" class="btn-primary">Update Profile</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
    <script src="API-Fetch/Assessment/Post.js"></script>
    <script src="script.js"></script>
    <script src="API-Fetch/Auth/auth.js"></script>
    <script src="API-Fetch/Content/ContentGet.js"></script>
    <!-- <script src="API-Fetch/User/Get.js"></script> -->
    
    <script>
        function switchTab(btn, id) {
            // Active buttonF
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');

            // Show content
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById(id + '-content').classList.add('active');
            if (id === 'my-students-content') {
                loadMyStudents();
            }
            // Nếu là tab Quiz Manager, fetch quizzes
            if (id === 'create-quiz') {
                fetchAndRenderQuizzes();
            }
            if (id === 'inst-settings') {
                loadProfileData();
            }
        }
        // Hàm xử lý xóa quiz
        async function deleteQuiz(quizId) {
            if (!confirm('Are you sure wanna delete this quiz?')) {
                return;  // Hủy nếu không confirm
            }

            try {
                const result = await deleteQuizAPI(quizId);
                alert(result.message || 'Quiz deleted successfully!');  // Hiển thị message từ API
                fetchAndRenderQuizzes();  // Refresh danh sách quizzes
            } catch (error) {
                alert('Error deleting quiz: ' + error.message);
            }
        }

        // 3. HÀM CHUYỂN TAB KHI BẤM "SEE MORE"
        function goToMyStudentsTab() {
            // Tìm nút tab "My Students" trên sidebar
            // (Selector tìm thẻ a có chứa onclick chứa chữ 'my-students')
            const myStudentBtn = document.querySelector('.sidebar a[onclick*="my-students"]');
            
            if (myStudentBtn) {
                // Kích hoạt sự kiện click vào nút đó -> Nó sẽ tự gọi hàm switchTab
                myStudentBtn.click();
            }
        }
        function populateAssignStudentDropdown() {
            const select = document.getElementById('assign-student');
            select.innerHTML = '<option value="">-- Select a student --</option>'; // Reset

            if (myStudents && myStudents.length > 0) {
                myStudents.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name || 'Chưa đặt tên'} (@${student.username || student.id})`;
                    select.appendChild(option);
                });
            } else {
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "No students available";
                option.disabled = true;
                select.appendChild(option);
            }
        }
        async function populateAssignSelect(assignedIds = []) {
            try {
                const teacherId = localStorage.getItem('userId');
                const students = await getMyStudentsAPI(teacherId);  // Lấy tất cả myStudents

                // Filter chỉ giữ students chưa assign (không có ID trong assignedIds)
                const availableStudents = students.filter(student => !assignedIds.includes(student.id));

                const select = document.getElementById('assign-student');
                select.innerHTML = '<option value="">-- Select a student --</option>';  // Reset

                availableStudents.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name || student.username} (@${student.username || student.id})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error populating assign select:', error);
                // Optional: Hiển thị lỗi trong UI nếu cần
            }
        }
        function showCreateQuizForm() {
            document.getElementById('quiz-list-view').style.display = 'none';
            document.getElementById('quiz-form-view').style.display = 'block';
            document.getElementById('quiz-form-title').textContent = 'Create New Quiz';  // Reset to create mode
            document.getElementById('quiz-id').value = '';  // Clear quizId for create
            // Optional: Reset form fields if needed
            document.getElementById('create-quiz-form').reset();
            const container = document.getElementById('questions-container');
            container.innerHTML = '';  // Clear questions
            questionId = 0;
            addQuestion();  // Add default first question

            // Added: Reset steps to start at Basic Information
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
            document.getElementById('step-basic').classList.add('active');
            document.querySelectorAll('.step-btn').forEach(el => el.classList.remove('active'));
            document.querySelector('.step-btn[onclick="switchQuizStep(\'basic\')"]').classList.add('active');  // Activate Basic button
            populateAssignSelect();
        }
        function hideCreateQuizForm() {
            document.getElementById('quiz-form-view').style.display = 'none';
            document.getElementById('quiz-list-view').style.display = 'block';
            document.getElementById('quiz-form-title').textContent = 'Create New Quiz';  // Reset title
            document.getElementById('quiz-id').value = '';  // Clear quizId
            // Optional: Reset form
            document.getElementById('create-quiz-form').reset();
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            questionId = 0;
            fetchAndRenderQuizzes();  // Refresh list on back
        }
        // Hàm fetch và render quizzes động vào quiz-manager-grid
        // Sửa hàm fetchAndRenderQuizzes trong script của teacher.html để fetch full quiz details bao gồm assignee
async function fetchAndRenderQuizzes() {
    const grid = document.getElementById('quiz-manager-grid');
    if (!grid) return;

    grid.innerHTML = '<div style="text-align:center; padding:20px;"><i class="fas fa-spinner fa-spin"></i> Loading...</div>';

    const userId = localStorage.getItem('userId');
    if (!userId) {
        grid.innerHTML = '<p>Error: Please login to view quizzes.</p>';
        return;
    }

    try {
        let quizSummaries = await getQuizzesByUserIdAPI(userId);
        if (quizSummaries && quizSummaries.length > 0) {
            // Fetch full details cho mỗi quiz để lấy assignee
            const quizzes = await Promise.all(quizSummaries.map(async (summary) => {
                try {
                    return await getQuizByIdAPI(summary.id);
                } catch (err) {
                    console.error(`Error fetching details for quiz ${summary.id}:`, err);
                    return { ...summary, assignee: [] };  // Fallback nếu lỗi
                }
            }));

            grid.innerHTML = quizzes.map(quiz => `
                <div class="quiz-manage-card">
                    <div class="q-info">
                        <h4>${quiz.title}</h4>
                        <p>${quiz.description}</p>
                        <p>Assigned to: ${quiz.assignee && quiz.assignee.length > 0 ? quiz.assignee.map(a => a.username).join(', ') : 'None'}</p>
                    </div>
                    <button class="btn-outline" onclick="editQuiz('${quiz.id}')">Edit</button>
                    <button type="button" class="btn-outlines" onclick="deleteQuiz('${quiz.id}')">Delete</button>
                </div>
            `).join('');
        } else {
            grid.innerHTML = '<p>No quizzes found.</p>';
        }
    } catch (error) {
        console.error('Error fetching quizzes:', error);
        grid.innerHTML = '<p>Error loading quizzes. Please try again later.</p>';
    }
}

// Sửa hàm editQuiz để load assigned student từ assignee field
async function editQuiz(quizId) {
    try {
        const quiz = await getQuizByIdAPI(quizId);
        showCreateQuizForm();  // Show form (resets to create, but we'll override)
        document.getElementById('quiz-form-title').textContent = 'Edit Quiz';
        document.getElementById('quiz-id').value = quiz.id;
        document.getElementById('quiz-title').value = quiz.title;
        document.getElementById('quiz-description').value = quiz.description;
        document.getElementById('publish-button').textContent = 'Update Quiz';

        const assignedIds = quiz.assignee ? quiz.assignee.map(a => a.id || a.userId) : [];  // Điều chỉnh field ID nếu khác

        // Populate select chỉ với students chưa assign
        populateAssignSelect(assignedIds);

        // Hiển thị current assigned students
        const currentAssigned = document.getElementById('current-assigned');
        const assignedNames = document.getElementById('current-assigned-names');
        if (quiz.assignee && quiz.assignee.length > 0) {
            currentAssigned.style.display = 'block';
            assignedNames.textContent = quiz.assignee.map(a => `${a.name || a.username} (@${a.username || a.userId})`).join(', ');
        } else {
            currentAssigned.style.display = 'none';
            assignedNames.textContent = '';
        }

        // Clear existing questions
        const container = document.getElementById('questions-container');
        container.innerHTML = '';
        questionId = 0;

        // Populate questions (giữ nguyên code cũ)
        quiz.questions.forEach(q => {
            addQuestion();  // Creates a new question group and increments questionId
            const group = container.lastChild;  // Get the newly added group

            let baseQuestion = q.question;
            const typeSelect = group.querySelector('.question-type');
            typeSelect.value = q.type;
            toggleOptions(typeSelect);

            if (q.type === 'multiple-choice') {
                // Parse embedded options (format: "Question\nA. Opt1\nB. Opt2...")
                const lines = q.question.split('\n');
                baseQuestion = lines[0];
                const options = lines.slice(1).map(line => line.substring(3).trim());  // Remove "A. " (3 chars: letter + . + space)

                // Clear default option and rebuild
                const optsContainer = group.querySelector('.options-container');
                optsContainer.innerHTML = '<h4>Options</h4>';  // Reset options
                options.forEach((opt, i) => {
                    const optGroup = document.createElement('div');
                    optGroup.className = 'option-group';
                    optGroup.innerHTML = `<input type="text" class="option-text" placeholder="Option ${i + 1}" value="${opt}">`;
                    optsContainer.appendChild(optGroup);
                });
                // Re-append the "Add Option" button (it gets removed by innerHTML reset)
                const addBtn = document.createElement('button');
                addBtn.type = 'button';
                addBtn.className = 'add-option';
                addBtn.textContent = 'Add Option';
                addBtn.onclick = function() { addOption(this); };
                optsContainer.appendChild(addBtn);
            }

            group.querySelector('.question-text').value = baseQuestion;
            group.querySelector('.question-explanation').value = q.questionExplanation || '';
            group.querySelector('.answer-explanation').value = q.answerExplanation || '';
            group.querySelector('.correct-answer').value = q.correctAnswer || '';
        });
    } catch (error) {
        alert('Error loading quiz for edit: ' + error.message);
    }
} 
       let questionId = 1;
        function addQuestion() {
            questionId++;
            const container = document.getElementById('questions-container');
            const newQuestion = document.createElement('div');
            newQuestion.className = 'question-group';
            newQuestion.innerHTML = `
                <h3>Question ${questionId}</h3>
                <input type="text" class="question-text" placeholder="Question" required>
                <select class="question-type" required onchange="toggleOptions(this)">
                    <option value="">Select Type</option>
                    <option value="text">Text</option>
                    <option value="number">Number</option>
                    <option value="multiple-choice">Multiple Choice</option>
                </select>
                <div class="options-container" style="display: none;">
                    <h4>Options</h4>
                    <div class="option-group">
                        <input type="text" class="option-text" placeholder="Option 1" >
                    </div>
                    <button type="button" class="add-option" onclick="addOption(this)">Add Option</button>
                </div>
                <textarea class="question-explanation" placeholder="Question Explanation (optional)"></textarea>
                <textarea class="answer-explanation" placeholder="Answer Explanation (optional)"></textarea>
                <input type="text" class="correct-answer" placeholder="Correct Answer (optional)">
            `;
            container.appendChild(newQuestion);
        }

        // Hàm toggle options dựa trên type
        function toggleOptions(select) {
            const optionsContainer = select.parentElement.querySelector('.options-container');
            if (select.value === 'multiple-choice') {
                optionsContainer.style.display = 'block';
            } else {
                optionsContainer.style.display = 'none';
            }
        }

        // Hàm add dynamic option cho multiple-choice
        function addOption(button) {
            const optionsContainer = button.parentElement;
            const optionGroups = optionsContainer.querySelectorAll('.option-group');
            const newOption = document.createElement('div');
            newOption.className = 'option-group';
            newOption.innerHTML = `
                <input type="text" class="option-text" placeholder="Option ${optionGroups.length + 1}" >
            `;
            button.before(newOption);
        }

                // Handle submit form create quiz
        const createQuizForm = document.getElementById('create-quiz-form');
if (createQuizForm) {
    createQuizForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        console.log('Submit event triggered!');
        const userId = localStorage.getItem('userId');
        if (!userId) {
            showMessage('quiz-message', 'User ID not found. Please login again.', 'error');
            return;
        }

        // Thu thập data (giữ nguyên)
        const title = document.getElementById('quiz-title').value;
        const description = document.getElementById('quiz-description').value;
        const questions = [];
        const questionGroups = document.querySelectorAll('.question-group');
        questionGroups.forEach((group, index) => {
            const type = group.querySelector('.question-type').value;
            let questionText = group.querySelector('.question-text').value;  // Start with base question
            const questionObj = {
                id: index + 1,
                question: questionText,  // Will update if multiple-choice
                type: type,
                questionExplanation: group.querySelector('.question-explanation').value || '',
                answerExplanation: group.querySelector('.answer-explanation').value || '',
                correctAnswer: group.querySelector('.correct-answer').value || ''
            };

            if (type === 'multiple-choice') {
                const options = [];
                group.querySelectorAll('.option-text').forEach(opt => {
                    if (opt.value) options.push(opt.value);
                });
                // Embed options into question string (e.g., "What is...? A. Opt1 B. Opt2")
                questionObj.question += '\n' + options.map((o, i) => `${String.fromCharCode(65 + i)}. ${o}`).join('\n');
                // Assume correctAnswer is a letter like "A" or index like "1"
            }

            questions.push(questionObj);
        });

        const quizId = document.getElementById('quiz-id').value;
        let quizData;
        let result;
        const selectedStudentId = document.getElementById('assign-student').value;

        if (quizId) {
            // Update quiz
            quizData = {
                quizId,  // Add for update (matches API spec)
                title,
                description,
                questions
            };
            console.log('Quiz Update Data to Send:', JSON.stringify(quizData, null, 2));
            result = await updateQuizAPI(quizId, quizData);
            showMessage('quiz-message', 'Quiz updated successfully!', 'success');

            // Assign thêm student nếu có select
            if (selectedStudentId) {
                await assignQuizToUserAPI(quizId, selectedStudentId);
                showMessage('quiz-message', 'Additional student assigned successfully!', 'success');
            }
        } else {
            // Create quiz (giữ nguyên)
            const beforeQuizzes = await getQuizzesByUserIdAPI(userId);
            console.log('Before Quizzes:', beforeQuizzes);
            quizData = {
                userId,  // Keep for create
                title,
                description,
                questions
            };
            console.log('Quiz Create Data to Send:', JSON.stringify(quizData, null, 2));
            result = await createQuizAPI(quizData);
            console.log(result);
            showMessage('quiz-message', 'Quiz created successfully!', 'success');
            await new Promise(resolve => setTimeout(resolve, 1000));
            const afterQuizzes = await getQuizzesByUserIdAPI(userId);
            console.log('After Quizzes:', afterQuizzes);
            const newQuiz = afterQuizzes.find(q => !beforeQuizzes.some(b => b.id === q.id));
            if (!newQuiz) {
                showMessage('quiz-message', 'Could not find newly created quiz. Please check the list.', 'error');
                return;
            }

            console.log('New Quiz ID:', newQuiz.id);  // Log để confirm
            if (selectedStudentId) {
                await assignQuizToUserAPI(newQuiz.id, selectedStudentId); // Assign cho create
                showMessage('quiz-message', 'Quiz assigned to student successfully!', 'success');
            }
        }
        console.log(result);
        createQuizForm.reset();  // Reset form
        document.getElementById('quiz-id').value = '';  // Clear to prevent issues on next create
        // Refresh quizzes list
        fetchAndRenderQuizzes();
        setTimeout(() => {
            hideCreateQuizForm();
        }, 2000);
    });
}

        // Function showMessage (copy từ AuthPost.js nếu cần, hoặc define here)
        function showMessage(elementId, message, type) {
            const el = document.getElementById(elementId);
            if (!el) return;
            el.textContent = message;
            el.className = `message-box ${type}`;
            el.style.display = 'block';
            setTimeout(() => { el.style.display = 'none'; }, 3000);
        }

        // Gọi fetch quizzes khi load page nếu tab Quiz đang active (optional)
        if (document.querySelector('#create-quiz-content').classList.contains('active')) {
            fetchAndRenderQuizzes();
        }
       
    </script>
    <script>
// Dropdown Avatar
const avatarWrapper = document.getElementById('avatar-wrapper');
const userDropdown = document.getElementById('user-dropdown');

avatarWrapper.addEventListener('click', (e) => {
    e.stopPropagation();
    userDropdown.classList.toggle('show');
});

// Đóng dropdown khi click ngoài
document.addEventListener('click', () => {
    userDropdown.classList.remove('show');
});

// Modal functions
function showChangePasswordModal() {
    document.getElementById('change-password-modal').classList.add('show');
    userDropdown.classList.remove('show'); // đóng dropdown
    document.getElementById('change-password-form').reset();
    document.getElementById('password-message').textContent = '';
}

function hideChangePasswordModal() {
    document.getElementById('change-password-modal').classList.remove('show');
}



// Submit form
document.getElementById('change-password-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const oldPassword = document.getElementById('old-password').value;
    const newPassword = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;
    const msgEl = document.getElementById('password-message');

    if (newPassword !== confirmPassword) {
        msgEl.textContent = 'New passwords do not match!';
        msgEl.style.color = '#e74c3c';
        return;
    }

    try {
        msgEl.textContent = 'Updating...';
        msgEl.style.color = '#1A64F0';

        await changePasswordAPI(oldPassword, newPassword, confirmPassword);

        msgEl.textContent = 'Password changed successfully!';
        msgEl.style.color = '#27ae60';

        setTimeout(() => {
            hideChangePasswordModal();
        }, 1500);

    } catch (err) {
        msgEl.textContent = err.message || 'Something went wrong';
        msgEl.style.color = '#e74c3c';
    }
});
</script>
<script>
let myStudents = [];

// Cập nhật hàm loadMyStudents trong script của teacher.html
async function loadMyStudents() {
    const loading = document.getElementById('students-loading');
    const empty = document.getElementById('students-empty');
    const list = document.getElementById('students-list');
    const dashboardstudentlist = document.getElementById('dashboard-students-list');
    loading.style.display = 'block';
    empty.style.display = 'none';
    list.innerHTML = '';
    dashboardstudentlist.innerHTML = '';
    try {
        const teacherId = localStorage.getItem('userId');
        if (!teacherId) {
            throw new Error('Không tìm thấy ID giáo viên. Vui lòng đăng nhập lại.');
        }

        myStudents = await getMyStudentsAPI(teacherId);

        loading.style.display = 'none';

        if (!myStudents || myStudents.length === 0) {
            empty.style.display = 'block';
            return;
        }

        // Render list với style mới giống hình (không dùng ảnh thật, dùng placeholder màu)
        list.innerHTML = myStudents.map(student => `
            <div style="
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                min-width: 200px;
                width: auto;
                text-align: center;
                overflow: hidden;
            ">
                <div style="padding: 15px;">
                    <h4>${student.name || student.username}</h4>
                    <p>@${student.username || student.id}</p>
                    <p style="margin: 5px 0; color: #666; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                <i class="fas fa-envelope"></i> ${student.email || 'Chưa có email'}
                            </p>
                    <p style="margin: 5px 0 10px; color: #666; font-size: 0.9rem;">
                        Student
                    </p>
                    <button style="
                        background: #1A64F0;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 4px;
                        cursor: pointer;
                        width: 100%;
                        font-size: 0.95rem;
                    "  onclick="goToMyStudentsTab()">
                        Contact
                    </button>
                </div>
            </div>
        `).join('');
        dashboardstudentlist.innerHTML = myStudents.map(student => `
            <div style="
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                min-width: 200px;
                width: auto;
                text-align: center;
                overflow: hidden;
            ">
                <div style="padding: 15px;">
                    <h4>${student.name || student.username}</h4>
                    <p>@${student.username || student.id}</p>
                    <p style="margin: 5px 0; color: #666; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                <i class="fas fa-envelope"></i> ${student.email || 'Chưa có email'}
                            </p>
                    <p style="margin: 5px 0 10px; color: #666; font-size: 0.9rem;">
                        Student
                    </p>
                    <button style="
                        background: #1A64F0;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 4px;
                        cursor: pointer;
                        width: 100%;
                        font-size: 0.95rem;
                    "  onclick="goToMyStudentsTab()">
                        Contact
                    </button>
                </div>
            </div>
        `).join('');

    } catch (error) {
        loading.style.display = 'none';
        list.innerHTML = `
            <div style="text-align:center; padding:40px; color:#e74c3c;">
                <p>⚠️ ${error.message}</p>
                <button onclick="loadMyStudents()" style="margin-top:10px; padding:8px 16px; background:#1A64F0; color:white; border:none; border-radius:8px; cursor:pointer;">Thử lại</button>
            </div>
        `;
    }
}
function showAddStudentModal() {
    const modal = document.getElementById('add-student-modal');
    modal.classList.add('show');
    loadAvailableStudents();
    document.getElementById('student-search').value = ''; // Reset search
}

function hideAddStudentModal() {
    const modal = document.getElementById('add-student-modal');
    modal.classList.remove('show');
}
// Load available students (all trừ myStudents)
async function loadAvailableStudents() {
    const loading = document.getElementById('add-students-loading');
    const empty = document.getElementById('add-students-empty');
    const list = document.getElementById('available-students-list');

    loading.style.display = 'block';
    empty.style.display = 'none';
    list.innerHTML = '';

    try {
        const allStudents = await getAllStudentsAPI();

        // Filter loại trừ myStudents (so sánh bằng id)
        const myStudentIds = new Set(myStudents.map(s => s.id));
        const available = allStudents.filter(s => !myStudentIds.has(s.id));

        loading.style.display = 'none';

        if (available.length === 0) {
            empty.style.display = 'block';
            return;
        }

        // Render list với nút Assign
        list.innerHTML = available.map(student => `
            <div class="student-card" style="margin-bottom:20px">
                <div class="info">
                    <h4>${student.name || 'Chưa đặt tên'}</h4>
                    <p>@${student.username || student.id}</p>
                   <p style="margin: 5px 0; color: #666; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                <i class="fas fa-envelope"></i> ${student.email || 'Chưa có email'}
                            </p>
                </div>
                <div class="avatar">${student.name ? student.name.charAt(0).toUpperCase() : 'S'}</div>
                <div class="actions">
                    <button class="btn-small btn-success" onclick="assignStudent('${student.id}')">Assign</button>
                </div>
            </div>
        `).join('');

    } catch (error) {
        loading.style.display = 'none';
        list.innerHTML = `
            <div style="text-align:center; padding:40px; color:#e74c3c;">
                <p>⚠️ ${error.message}</p>
                <button onclick="loadAvailableStudents()" style="margin-top:10px; padding:8px 16px; background:#1A64F0; color:white; border:none; border-radius:8px; cursor:pointer;">Thử lại</button>
            </div>
        `;
    }
}

// Hàm assign student
async function assignStudent(studentId) {
    try {
        const teacherId = localStorage.getItem('userId');
        await assignStudentAPI(teacherId, studentId);
        
        // Refresh lists
        loadMyStudents();
        loadAvailableStudents();
        
        // Optional: show success message
        alert('Đã giao học sinh thành công!');
    } catch (error) {
        alert('Lỗi: ' + error.message);
    }
}

// Hàm filter students theo search
function filterStudents() {
    const search = document.getElementById('student-search').value.toLowerCase();
    const cards = document.querySelectorAll('#available-students-list .student-card');
    
    cards.forEach(card => {
        const name = card.querySelector('h4').textContent.toLowerCase();
        const username = card.querySelector('p:nth-child(2)').textContent.toLowerCase();
        const email = card.querySelector('p:nth-child(3)').textContent.toLowerCase();
        
        if (name.includes(search) || username.includes(search) || email.includes(search)) {
            card.style.display = 'flex';
        } else {
            card.style.display = 'none';
        }
    });
}
// Gọi khi mở tab My Students (bạn thêm vào phần switch tab hiện tại)
// document.querySelector('[data-tab="my-students-content"]')?.addEventListener('click', loadMyStudents);
document.addEventListener('DOMContentLoaded', function() {
    // Load students cho preview trên dashboard luôn
    loadMyStudents();
    loadUserGreeting();
    // Nếu đang ở tab quiz thì load quiz
    if (document.getElementById('create-quiz-content').classList.contains('active')) {
        fetchAndRenderQuizzes();
    }
});
// Hoặc nếu dùng hàm showTab(tabId), thì thêm vào đó:
// if (tabId === 'my-students-content') loadMyStudents();

///// UPDATE PROFILE
async function loadProfileData() {
    const msgEl = document.getElementById('profile-message');
    if (!msgEl) return;  // If not in settings tab, skip

    msgEl.textContent = '';
    try {
        const userId = localStorage.getItem('userId');
        if (!userId) {
            msgEl.textContent = 'User ID not found. Please login again.';
            msgEl.style.color = '#e74c3c';
            return;
        }

        const user = await getUserByIdAPI(userId);
        
        document.getElementById('profile-username').value = user.username || '';
        document.getElementById('profile-name').value = user.name || '';
        document.getElementById('profile-email').value = user.email || '';

    } catch (err) {
        msgEl.textContent = err.message || 'Failed to load profile data';
        msgEl.style.color = '#e74c3c';
    }
}
document.getElementById('update-profile-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const username = document.getElementById('profile-username').value;
    const name = document.getElementById('profile-name').value;
    const email = document.getElementById('profile-email').value;
    const msgEl = document.getElementById('profile-message');
    const userId = localStorage.getItem('userId');

    if (!userId) {
        msgEl.textContent = 'User ID not found. Please login again.';
        msgEl.style.color = '#e74c3c';
        return;
    }

    const payload = {
        id: userId,
        username,
        role: 'Teacher',  // Giả sử role không thay đổi, hoặc lấy từ current user nếu cần
        name,
        email
    };

    try {
        msgEl.textContent = 'Updating...';
        msgEl.style.color = '#1A64F0';

        await updateUserAPI(payload);

        msgEl.textContent = 'Profile updated successfully!';
        msgEl.style.color = '#27ae60';

        // Optional: Update greeting
        document.querySelector('.greeting h2').textContent = `Good Morning, ${name}!`;

        setTimeout(() => {
            msgEl.textContent = '';
            const dashboardBtn = document.querySelector('.tab-btn[onclick*="\'inst-dashboard\'"]');
            if (dashboardBtn) {
                switchTab(dashboardBtn, 'inst-dashboard');
            }
        }, 1000);

    } catch (err) {
        msgEl.textContent = err.message || 'Something went wrong';
        msgEl.style.color = '#e74c3c';
    }
});

////Update greeting
async function loadUserGreeting() {
    try {
        const userId = localStorage.getItem('userId');
        if (!userId) {
            console.warn('User ID not found. Greeting will remain default.');
            return;
        }

        const user = await getUserByIdAPI(userId);
        const greetingH2 = document.querySelector('.greeting h2');
        if (greetingH2 && user.name) {
            greetingH2.textContent = `Good Morning, ${user.name}!`;
        } else if (greetingH2 && user.username) {
            // Fallback to username if name is not set
            greetingH2.textContent = `Good Morning, ${user.username}!`;
        }
    } catch (err) {
        console.error('Error loading user greeting:', err);
    }
}
</script>
</body>
</html>